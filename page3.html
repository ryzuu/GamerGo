<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Racing</title>
    <link rel="stylesheet" href="./style/style2.css">
</head>

<body>

    <header>
        <a href="index.html" id="menu">
            <img id="logo" src="./images/GamerGO.png" alt="">
        </a>
        <a href="page1.html">
            <div class="el_menu" id="txt">Информация</div>
        </a>
        <a href="page2.html">
            <div class="el_menu" id="txt">Платформы</div>
        </a>
        <a href="page3.html">
            <div class="el_menu" id="txt">Начать с начала.</div>
        </a>
    </header>

    <script src="anime.js"></script>
    <script>
        anime({
            targets: '#logo',
            translateX: 1000,
            duration: 1250,
            easing: 'easeInOutExpo'
        })
    </script>

    <main>

        <div id="canvas_holder">
            <canvas width="288" height="512" id="canvas"></canvas>
        </div>
        <div id="list_holder">
            <h2>High Scores</h2>
            <div>
                <ul>
                    <li>1. <span id="first">AAA</span>..................<span id="firstRecord">000</span></li>
                    <li>2. <span id="second">BBB</span>..................<span id="secondRecord">000</span></li>
                    <li>3. <span id="third">CCC</span>..................<span id="thirdRecord">000</span></li>
                    <li>4. <span id="fourth">DDD</span>..................<span id="fourthRecord">000</span></li>
                    <li>5. <span id="fifth">EEE</span>..................<span id="fifthRecord">000</span></li>
                    <li>6. <span id="sixth">FFF</span>..................<span id="sixthRecord">000</span></li>
                    <li>7. <span id="seventh">GGG</span>..................<span id="seventhRecord">000</span></li>
                    <li>8. <span id="eighth">HHH</span>..................<span id="eighthRecord">000</span></li>
                    <li>9. <span id="ninth">III</span>..................<span id="ninthRecord">000</span></li>
                    <li>10. <span id="tenth">JJJ</span>..................<span id="tenthRecord">000</span></li>
                </ul>
            </div>
        </div>

    </main>

    <footer>
        <h5 id="txt3">
            <a href="#" class="reference">Контакты</a>
        </h5>

        <h5 id="txt2">
            <a href="page2.html" class="reference">Дальше</a>
        </h5>
    </footer>

    <script>

        ctx = canvas.getContext('2d');

        let bird = new Image();
        bird.src = './images/flappy_bird_bird.png';

        let bg = new Image();
        bg.src = './images/flappy_bird_bg.png';

        let fg = new Image();
        fg.src = './images/flappy_bird_fg.png';

        let pipeUp = new Image();
        pipeUp.src = './images/flappy_bird_pipeUp.png';

        let pipeBottom = new Image();
        pipeBottom.src = './images/flappy_bird_pipeBottom.png';

        let x = 10;
        let y = 150;

        let w = canvas.width;
        let h = canvas.height;

        let score = 0;

        let pause = false;

        let time = 0;

        let dead = false;

        let recordName;
        let recordScore;
        
        let firstRec = document.getElementById("first");
        let secondRec = document.getElementById("second");
        let thirdRec = document.getElementById("third");
        let fourthRec = document.getElementById("fourth");
        let fifthRec = document.getElementById("fifth");
        let sixthRec = document.getElementById("sixth");
        let seventhRec = document.getElementById("seventh");
        let eighthRec = document.getElementById("eighth");
        let ninthRec = document.getElementById("ninth");
        let tenthRec = document.getElementById("tenth");

        let firstRecordScore = document.getElementById("firstRecord");
        let secondRecordScore = document.getElementById("secondRecord");
        let thirdRecordScore = document.getElementById("thirdRecord");
        let fourthRecordScore = document.getElementById("fourthRecord");
        let fifthRecordScore = document.getElementById("fifthRecord");
        let sixthRecordScore = document.getElementById("sixthRecord");
        let seventhRecordScore = document.getElementById("seventhRecord");
        let eighthRecordScore = document.getElementById("eighthRecord");
        let ninthRecordScore = document.getElementById("ninthRecord");
        let tenthRecordScore = document.getElementById("tenthRecord");

        class Record{
            recordName;
            recordScore;
            constructor(recordName, recordScore) {
                this.recordName = recordName;
                this.recordScore = recordScore;
            }            
        }

        class Pipe {
            x;
            y;
            constructor() {
                this.x = w;
                this.y = Math.floor(Math.random() * (0 - -200 + 1)) + -200;
            }
        }

        pipe = [];
        pipe[0] = new Pipe();
        pipe[1] = new Pipe();
        pipe[1].x -= 150;

        var pole_x = w;
        var pole_y = h;



        function draw() {

            ctx.drawImage(bg, pole_x - w, 0);
            ctx.drawImage(bg, pole_x, 0);
            pole_x -= 1;
            if (pole_x == 0) pole_x = w;
            for (i = 0; i < pipe.length; i++) {
                time++;
                ctx.drawImage(pipeUp, pipe[i].x, pipe[i].y);
                ctx.drawImage(pipeBottom, pipe[i].x, pipe[i].y + pipeUp.height + 90);
                pipe[i].x -= 1;
                if (time >= 1800) {
                    pipe[i].x = pipe[i].x - 2;
                }
                if (pipe[i].x <= 0 - pipeUp.width) {
                    pipe[i].x = w;
                    pipe[i].y = Math.floor(Math.random() * (0 - -200 + 1)) + -200;
                }
            }
            ctx.drawImage(fg, 0, 400);
            ctx.drawImage(bird, x, y);
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.fillText(score, 10, 30);

            if (y + bird.height >= 400 || y - bird.height <= 0) {
                ctx.fillStyle = "red";
                ctx.font = "50px Arial";
                ctx.fillText("YOU DIED", 15, 200);
                pause = true;
                dead = true;
            }

            for (i = 0; i < pipe.length; i++) {
                if (x + bird.width >= pipe[i].x && x <= pipe[i].x + 52) {
                    if (y + bird.height >= pipe[i].y + 252 && y + bird.height <= pipe[i].y + 342) {
                        score++;
                    } else {
                        ctx.fillStyle = "red";
                        ctx.font = "50px Arial";
                        ctx.fillText("YOU DIED", 15, 200);
                        pause = true;
                        dead = true;
                    }

                }
            }

            if(dead == true){
                recordName = prompt("Запомнить ваш счет?\n(Если да, введите ваше имя, нет - нажмите отмена)", );
                recordScore = score;
                /*for(i = 1; i < localStorage.length; i+2){
                    if(recordScore > localStorage[i]){
                        localStorage[i].setItem()
                    }
                }*/
                let g = new Record(recordName, recordScore)
                localStorage.setItem(g, 1);
                alert(localStorage.key(1));
            }

            y = y + 1.5




            if (pause != true)
                requestAnimationFrame(draw);
        }

        bg.onload = draw;

        canvas.addEventListener('click', function (e) {
            y = y - 40;
        })



    </script>

</body>

</html>